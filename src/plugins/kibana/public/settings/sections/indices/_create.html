<kbn-settings-app section="indices">
  <kbn-settings-indices>
    <div ng-controller="settingsIndicesCreate" class="kbn-settings-indices-create">
      <div class="page-header">
        <h1>配置索引模式</h1>
	为了使用此系统，你必须至少配置一个索引模式，用于识别Elasticsearch索引以运行搜索以及分析。另外，模式也被用于fields部分的配置。
      </div>
      <div>
        <form name="form" role="form" class="well" ng-submit="createIndexPattern()">
          <div class="form-group time-and-pattern">
            <label>
              <input
                ng-model="index.isTimeBased"
                type="checkbox">
              索引包含基于时间的事件
            </label>
            <br>
            <label ng-if="index.isTimeBased">
              <input ng-model="index.nameIsPattern" type="checkbox">
	      使用事件时间来创建索引名字 <small>[DEPRECATED]</small>
            </label>
          </div>

          <div class="form-group" ng-if="index.isTimeBased && index.nameIsPattern">
            <div class="alert alert-warning">
              <h4>基于时间间隔的索引模式是过时的，将来可能不再使用！</h4>
              <p>
                我们 <strong>强烈建议</strong> 使用通配符索引名来替代基于时间间隔的索引模式。
              </p>
              <p>
                Kibana is now smart enough to automatically determine which
                indices to search against within the current time range for
                wildcard index patterns. This means that wildcard
                index patterns now get the same performance optimizations when
                searching within a time range as time-interval patterns.
              </p>
            </div>
            <label>
              Index pattern interval&nbsp;
              <kbn-info info="The interval at which index names rotate."></kbn-info>
            </label>
            <select
              required
              ng-options="opt.display for opt in index.nameIntervalOptions"
              ng-model="index.nameInterval"
              class="form-control">
            </select>
          </div>

          <div class="form-group">
            <label>
              索引名或模式
            </label>
            <p class="help-block" ng-if="!index.nameIsPattern">模式使用 * 作为通配符定义动态索引名. 例如: logstash-*</p>
            <p class="help-block" ng-if="index.isTimeBased && index.nameIsPattern">模式能定义动态索引名. 索引名中的静态文本使用方括号标识. 例如: [logstash-]YYYY.MM.DD. 请注意, 星期被设置为以星期一开始的ISO星期模式. &mdash;
              <small><a target="_blank" href="http://momentjs.com/docs/#/displaying/format/">日期格式文档</a></small></p>
            <input
              ng-model="index.name"
              ng-attr-placeholder="{{index.defaultName}}"
              ng-model-options="{ updateOn: 'default blur', debounce: {'default': 2500, 'blur': 0} }"
              validate-index-name
              name="name"
              required
              type="text"
              class="form-control">
              <small ng-show="index.nameInterval.name == 'weeks'">
                <strong>Note: </strong>
                I noticed you're using weekly indices. Kibana requires ISO weeks be used in your index creation.
                See <a href="https://en.wikipedia.org/wiki/ISO_week_date" target="_blank" title="Wikipedia: ISO Week Date">Wikipedia: ISO Week Date</a>
              </small>
            </div>

          <section>
            <div class="alert alert-danger" ng-repeat="err in index.patternErrors">
              {{err}}
            </div>

            <div class="alert alert-info" ng-if="index.samples">
              试图匹配下面的索引和别名:
              <ul>
                <li ng-repeat="sample in index.samples">{{sample}}</li>
              </ul>
              <button type="button" ng-click="moreSamples(true)" class="btn btn-default">
                扩展搜索
              </button>
            </div>

            <div class="alert alert-{{index.existing.class}}" ng-if="index.existing">
              Pattern matches {{index.existing.matchPercent}} of existing indices and aliases
              <ul>
                <li ng-repeat="match in index.existing.matches | orderBy:'toString()'| limitTo: index.sampleCount">{{match}}</li>
              </ul>
              <button
                ng-if="index.sampleCount < index.existing.matches.length"
                ng-click="moreSamples()"
                type="button"
                class="btn btn-default">
                扩展搜索
              </button>
            </div>

            <div class="alert alert-info" ng-if="index.existing.failures.length">
              已发现的索引和别名, 但与模式不匹配:
              <ul>
                <li ng-repeat="match in index.existing.failures | limitTo: index.sampleCount">{{match}}</li>
              </ul>
              <a
                ng-if="index.sampleCount < index.existing.matches.length"
                ng-click="moreSamples()"
                class="alert-link">
                更多
              </a>
            </div>
          </section>

          <div class="form-group" ng-if="index.isTimeBased && !index.fetchFieldsError">
            <label>
              时间-字段名
              &nbsp;
              <kbn-info info="此字段使用全局时间过滤器以过滤事件"></kbn-info>
              &nbsp;
              <small>
                <a ng-click="refreshFieldList();"> 刷新字段</a>
              </small>
            </label>
            <select
              required
              ng-if="!index.fetchFieldsError"
              ng-options="field.name for field in index.dateFields"
              ng-model="index.timeField"
              auto-select-if-only-one="index.dateFields"
              class="form-control">
            </select>
          </div>

          <button
            ng-disabled="form.$invalid || index.fetchFieldsError"
            ng-class="index.fetchFieldsError ? 'btn-default' : 'btn-success'"
            type="submit"
            class="btn">
            <span ng-hide="form.name.$error.indexNameInput">{{index.fetchFieldsError || "Create" }}</span>
            <span ng-show="form.name.$error.indexNameInput">非法索引名模式.</span>
          </button>
        </form>
      </div>
    </div>
  </kbn-settings-indices>
</kbn-settings-app>
